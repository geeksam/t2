- panel 'currently_working_on' do
  %h2 Currently Working On
  - if @current_tb.blank?
    Nothing at the moment...
  - else
    = render :partial => 'current_tb', :object => @current_tb

- panel 'active_tasks' do
  %h2 Active Tasks
  - Task.active_list_by_project.each do |project, tasks|
    - is_current = tasks.include?(@current_task)
    - expandable("project_#{project.id}", :float_link => 'right', :collapsed => !is_current) do |exp|
      %h3=link_to(project.name, project, :class => 'subtle')
      - exp.less {}
      - exp.more do
        %ul.tasks
          - tasks.each do |task|
            %li
              = link_to(task.name, task, :class => 'subtle')
              = ' &nbsp;'
              = bracket_link link_to('edit', edit_task_path(task))
              - with_options(:method => :post) do |post|
                - if task.present? && task.is_current?
                  = bracket_link post.link_to('Clock out', clock_out_path), 'clock_out'
                - else
                  = bracket_link post.link_to('Clock in',  clock_in_task_path(task)), 'clock_in'

- panel 'bulk_task_entry' do
  %h2 Bulk Task Entry


- content_for :sidebar do
  - panel 'time_summary' do
    %h2= 'Hours Today: ' + elapsed(@todays_tbs.sum(&:elapsed_time))
    - if false && client
      %h2== ONLY FOR: #{client.name}
    .time_summary== This week: <strong>#{"[todo]"}</strong>
    %br
    - if false
      / = time_summary 'This month',  time_summaries[:this_month]
      / = time_summary 'Last month:', time_summaries[:last_month]
      / = time_summary 'Two months ago:', time_summaries[:two_months_ago]
      / = time_summary 'Three months ago:', time_summaries[:three_months_ago]

  - panel 'todays_time_blocks' do
    %h2 Today's Time Blocks
    %table
      %tr
        %th Task
        %th Start
        %th End
        %th Elapsed
      - TimeBlock.today.each do |tb|
        %tr
          %td=tb.task_name
          %td=tb.start_time.try(:strftime, '%H:%M')
          %td=tb.end_time  .try(:strftime, '%H:%M')
          %td{ :align => 'right' }=link_to(elapsed(tb.elapsed_time), edit_time_block_path(tb))
